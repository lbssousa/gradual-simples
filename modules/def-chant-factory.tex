% chktex-file 1
% chktex-file 21

\makeatletter

\newcommand{\Map}[2]{\@for\p:={#2}\do{\expandafter#1\p}} % chktex 41
\def\@Antiphon@Annotation{}
\def\@Verse@Annotation{}
\def\@Verse@Pairs{}
\def\@Link@Text@L{}
\def\@Link@Text@R{}
\def\@Link@Ref@L{}
\def\@Link@Ref@R{}
\newcommand{\SetAntiphonAnnotation}[1]{\def\@Antiphon@Annotation{#1}}
\newcommand{\SetVerseAnnotation}[1]{\def\@Verse@Annotation{#1}}
\newcommand{\SetLinkTextL}[1]{\def\@Link@Text@L{#1}}
\newcommand{\SetLinkTextR}[1]{\def\@Link@Text@R{#1}}
\newcommand{\SetVersePairs}[1]{\def\@Verse@Pairs{#1}}

\newcommand{\MakeVerseL}[2]{%
  #1
  \nottoggle{disablehyperlinks}{\hyperlink{\@Link@Ref@L}{\@Link@Text@L}}{\@Link@Text@L}%
}
\newcommand{\MakeVerseR}[2]{%
  #2
  \nottoggle{disablehyperlinks}{\hyperlink{\@Link@Ref@R}{\@Link@Text@R}}{\@Link@Text@R}%
}
\newcommand{\MakeVerseLR}[2]{%
  #1
  \nottoggle{disablehyperlinks}{\hyperlink{\@Link@Ref@L}{\@Link@Text@L}}{\@Link@Text@L}
  \switchcolumn[1]
  #2
  \nottoggle{disablehyperlinks}{\hyperlink{\@Link@Ref@R}{\@Link@Text@R}}{\@Link@Text@R}
  \switchcolumn[0]*
}


\DeclareDocumentCommand{\MakeVerseItemL}{o m o m}{%
  \MakeVerseL{%
    \IfNoValueTF{#1}{\item}{\item[#1]} #2%
  }{%
    \IfNoValueTF{#3}{\item}{\item[#3]} #4%
  }%
}
\DeclareDocumentCommand{\MakeVerseItemR}{o m o m}{%
  \MakeVerseR{%
    \IfNoValueTF{#1}{\item}{\item[#1]} #2%
  }{%
    \IfNoValueTF{#3}{\item}{\item[#3]} #4%
  }%
}
\DeclareDocumentCommand{\MakeVerseItemLR}{o m o m}{%
  \MakeVerseLR{%
    \IfNoValueTF{#1}{\item}{\item[#1]} #2%
  }{%
    \IfNoValueTF{#3}{\item}{\item[#3]} #4%
  }%
}

\newcommand{\MakeVerseItemVoidL}[2]{\MakeVerseItemL[]{#1}[]{#2}}
\newcommand{\MakeVerseItemVoidR}[2]{\MakeVerseItemR[]{#1}[]{#2}}
\newcommand{\MakeVerseItemVoidLR}[2]{\MakeVerseItemLR[]{#1}[]{#2}}

\newcommand{\MakeVerseListL}[1]{\Map{\MakeVerseItemL}{#1}}
\newcommand{\MakeVerseListR}[1]{\Map{\MakeVerseItemR}{#1}}
\newcommand{\MakeVerseListLR}[1]{\Map{\MakeVerseItemLR}{#1}}

\DeclareDocumentCommand{\AllowPageFlush}{}{
  \nottoggle{compact}{%
    \clearpage%
  }{}
}

\DeclareDocumentCommand{\AllowPageBreak}{}{
  \nottoggle{compact}{%
    \clearpage\hbox{}\newpage%
  }{}
}

\NewDocumentCommand{\GregorioImportL}{s m m m m}{
  \bgroup
  \IfBooleanT{#1}{\gresetinitiallines{0}}
  \iftoggle{disablehyperlinks}{
    \gregorioscore{#2/#3/#4}
  }{
    \hypertarget{\@Link@Ref@L}{}\gregorioscore{#2/#3/#4}
  }
  \egroup
}

\NewDocumentCommand{\GregorioImportR}{s m m m m}{
  \bgroup
  \IfBooleanT{#1}{\gresetinitiallines{0}}
  \iftoggle{disablehyperlinks}{
    \gregorioscore{#2/#3/#5}
  }{
    \hypertarget{\@Link@Ref@R}{\gregorioscore{#2/#3/#5}}
  }
  \egroup
}

\NewDocumentCommand{\GregorioImportLR}{s m m m m}{
  \bgroup
  \IfBooleanT{#1}{\gresetinitiallines{0}}
  \gregorioscore{#2/#3/#4}
  \switchcolumn[1]
  \gregorioscore{#2/#3/#5}
  \switchcolumn[0]*
  \egroup
}

\NewDocumentCommand{\GregorioImport}{s m m m m}{%
  \iftoggle{compact}{
    \IfBooleanTF{#1}{
      \GregorioImportL*{#2}{#3}{#4}{#5}
    }{
      \GregorioImportL{#2}{#3}{#4}{#5}
    }
    \IfBooleanTF{#1}{
      \GregorioImportR*{#2}{#3}{#4}{#5}
    }{
      \GregorioImportR{#2}{#3}{#4}{#5}
    }
  }{
    \begin{paracol}{2}
      \IfBooleanTF{#1}{
        \GregorioImportLR*{#2}{#3}{#4}{#5}
      }{
        \GregorioImportLR{#2}{#3}{#4}{#5}
      }
    \end{paracol}
  }
}

\NewDocumentCommand{\MakeChantPsalmOneVerse}{s m m}{
  \def\@Link@Ref@L{index-cantuum/#2/#3/psalmus-v1}
  \def\@Link@Ref@R{index-cantuum/#2/#3/psalmus-v1-pt}
  \input{index-cantuum/#2/#3/psalmus}

  \begin{annotation}
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListL{\@Verse@Pairs}
      \end{greenumerate}
    }

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }

    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListR{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \end{paracol}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \begin{paracol}{2}
          \synccounter{enumi}
          \setcounter{enumi}{1}
          \switchcolumn[1]
          \setcounter{enumi}{1}
          \switchcolumn[0]*
          \MakeVerseListLR{\@Verse@Pairs}
        \end{paracol}
      \end{greenumerate}%
    }
  }
}

\NewDocumentCommand{\MakeChantPsalmTwoVerses}{s m m}{
  \def\@Link@Ref@L{index-cantuum/#2/#3/psalmus-v1}
  \def\@Link@Ref@R{index-cantuum/#2/#3/psalmus-v1-pt}
  \input{index-cantuum/#2/#3/psalmus}

  \begin{annotation}
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{2}
        \MakeVerseListL{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}

    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{2}
        \MakeVerseListR{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}
    \end{paracol}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \begin{paracol}{2}
          \synccounter{enumi}
          \setcounter{enumi}{2}
          \switchcolumn[1]
          \setcounter{enumi}{2}
          \switchcolumn[0]*
          \MakeVerseListLR{\@Verse@Pairs}
        \end{paracol}
      \end{greenumerate}%
    }
  }
}

\NewDocumentCommand{\MakeChantPsalmThreeVerses}{s m m}{
  \def\@Link@Ref@L{index-cantuum/#2/#3/psalmus-v1}
  \def\@Link@Ref@R{index-cantuum/#2/#3/psalmus-v1-pt}
  \input{index-cantuum/#2/#3/psalmus}

  \begin{annotation}
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v3}{psalmus-v3-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{3}
        \MakeVerseListL{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}

    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}
    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v3}{psalmus-v3-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{3}
        \MakeVerseListR{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v2}{psalmus-v2-pt}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v3}{psalmus-v3-pt}
    \end{paracol}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \begin{paracol}{2}
          \synccounter{enumi}
          \setcounter{enumi}{3}
          \switchcolumn[1]
          \setcounter{enumi}{3}
          \switchcolumn[0]*
          \MakeVerseListLR{\@Verse@Pairs}
        \end{paracol}
      \end{greenumerate}
    }%
  }
}

\NewDocumentCommand{\MakeChantLitany}{m m}{
  \input{index-cantuum/#1/#2/litany}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL{index-cantuum/#1}{#2}{kyrie}{kyrie-pt}
    \GregorioImportL*{index-cantuum/#1}{#2}{sancta-maria}{sancta-maria-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidL}{\SaintsPairs}
    \end{itemize}

    \GregorioImportL*{index-cantuum/#1}{#2}{propitius}{propitius-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidL}{\PropitiusPairs}
    \end{itemize}

    \GregorioImportL*{index-cantuum/#1}{#2}{peccatores}{peccatores-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidL}{\PeccatoresPairs}
    \end{itemize}

    \GregorioImportL*{index-cantuum/#1}{#2}{christe}{christe-pt}

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportR{index-cantuum/#1}{#2}{kyrie}{kyrie-pt}
    \GregorioImportR*{index-cantuum/#1}{#2}{sancta-maria}{sancta-maria-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidR}{\SaintsPairs}
    \end{itemize}

    \GregorioImportR*{index-cantuum/#1}{#2}{propitius}{propitius-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidR}{\PropitiusPairs}
    \end{itemize}

    \GregorioImportR*{index-cantuum/#1}{#2}{peccatores}{peccatores-pt}

    \begin{itemize}
      \Map{\MakeVerseItemVoidR}{\PeccatoresPairs}
    \end{itemize}

    \GregorioImportR*{index-cantuum/#1}{#2}{christe}{christe-pt}
  }{
    \begin{paracol}{2}
      \GregorioImportLR{index-cantuum/#1}{#2}{kyrie}{kyrie-pt}
      \GregorioImportLR*{index-cantuum/#1}{#2}{sancta-maria}{sancta-maria-pt}
    \end{paracol}

    \begin{itemize}
      \begin{paracol}{2}
        \Map{\MakeVerseItemVoidLR}{\SaintsPairs}
      \end{paracol}
    \end{itemize}

    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#1}{#2}{propitius}{propitius-pt}
    \end{paracol}

    \begin{itemize}
      \begin{paracol}{2}
        \Map{\MakeVerseItemVoidLR}{\PropitiusPairs}
      \end{paracol}
    \end{itemize}

    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#1}{#2}{peccatores}{peccatores-pt}
    \end{paracol}

    \begin{itemize}
      \begin{paracol}{2}
        \Map{\MakeVerseItemVoidLR}{\PeccatoresPairs}
      \end{paracol}
    \end{itemize}

    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#1}{#2}{christe}{christe-pt}
    \end{paracol}
  }
}

\NewDocumentCommand{\MakeChantAntiphonPsalm}{m O{} m O{#1} O{}}{
  \def\@Antiphon@L{antiphona\IfNoValueOrEmptyTF{#2}{}{.#2}}
  \def\@Antiphon@R{\@Antiphon@L-pt}
  \def\@Link@Ref@L{index-cantuum/#3/#4/\@Antiphon@L}
  \def\@Link@Ref@R{index-cantuum/#3/#4/\@Antiphon@R}
  \input{index-cantuum/antiphonae/#1/antiphona}
  \input{index-cantuum/#3/#4/psalmus}

  \begin{annotation}
    \ifdefempty{\@Antiphon@Annotation}{}{%
      \MakeAntiphonAnnotation{\@Antiphon@Annotation}%
      \ifdefempty{\@Verse@Annotation}{}{\\}%
    }%
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}
    \GregorioImportL*{index-cantuum/#3}{#4}{psalmus}{psalmus-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListL{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportR{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}
    \GregorioImportR*{index-cantuum/#3}{#4}{psalmus}{psalmus-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListR{\@Verse@Pairs}
      \end{greenumerate}%
    }

    #4\clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}
      \GregorioImportLR*{index-cantuum/#3}{#4}{psalmus}{psalmus-pt}
    \end{paracol}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \begin{paracol}{2}
          \synccounter{enumi}
          \setcounter{enumi}{1}
          \switchcolumn[1]
          \setcounter{enumi}{1}
          \switchcolumn[0]*
          \MakeVerseListLR{\@Verse@Pairs}
        \end{paracol}
      \end{greenumerate}%
    }

    #5
  }
}

\NewDocumentCommand{\MakeChantAntiphonPsalmExtended}{m O{} m O{#1} m}{%
  \MakeChantAntiphonPsalm{#1}[#2]{#3}[#4][#5]%
}

\NewDocumentCommand{\MakeChantAntiphon}{m O{}}{
  \def\@Antiphon@L{antiphona\IfNoValueOrEmptyTF{#2}{}{.#2}}
  \def\@Antiphon@R{\@Antiphon@L-pt}
  \def\@Link@Ref@L{index-cantuum/antiphonae/#1/\@Antiphon@L}
  \def\@Link@Ref@R{index-cantuum/amtiphonae/#1/\@Antiphon@R}
  \input{index-cantuum/antiphonae/#1/antiphona}

  \begin{annotation}
    \MakeAntiphonAnnotation{\@Antiphon@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportR{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}

    \clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR{index-cantuum/antiphonae}{#1}{\@Antiphon@L}{\@Antiphon@R}
    \end{paracol}
  }
}

\NewDocumentCommand{\MakeChantAlleluiaPsalm}{m m O{}}{
  \def\@Antiphon@L{antiphona}
  \def\@Antiphon@R{\@Antiphon@L-pt}
  \def\@Link@Ref@L{index-cantuum/psalmi-ad-alleluia/#2/\@Antiphon@L}
  \def\@Link@Ref@R{index-cantuum/psalmi-ad-alleluia/#2/\@Antiphon@R}
  \input{index-cantuum/antiphonae/alleluia.#1/antiphona}
  \input{index-cantuum/psalmi-ad-alleluia/#2/psalmus}

  \begin{annotation}
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}
    \GregorioImportL*{index-cantuum/psalmi-ad-alleluia}{#2}{psalmus}{psalmus-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListL{\@Verse@Pairs}
      \end{greenumerate}%
    }

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportR{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}
    \GregorioImportR*{index-cantuum/psalmi-ad-alleluia}{#2}{psalmus}{psalmus-pt}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \setcounter{enumi}{1}
        \MakeVerseListR{\@Verse@Pairs}
      \end{greenumerate}%
    }

    #3\clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}
      \GregorioImportLR*{index-cantuum/psalmi-ad-alleluia}{#2}{psalmus}{psalmus-pt}
    \end{paracol}

    \ifdefempty{\@Verse@Pairs}{}{%
      \begin{greenumerate}
        \begin{paracol}{2}
          \synccounter{enumi}
          \setcounter{enumi}{1}
          \switchcolumn[1]
          \setcounter{enumi}{1}
          \switchcolumn[0]*
          \MakeVerseListLR{\@Verse@Pairs}
        \end{paracol}
      \end{greenumerate}%
    }

    #3
  }
}

\NewDocumentCommand{\MakeChantAlleluia}{m O{}}{
  \def\@Antiphon@L{antiphona}
  \def\@Antiphon@R{\@Antiphon@L-pt}
  \def\@Link@Ref@L{index-cantuum/antiphonae/#1/\@Antiphon@L}
  \def\@Link@Ref@R{index-cantuum/antiphonae/#1/\@Antiphon@R}
  \input{index-cantuum/antiphonae/alleluia.#1/antiphona}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportR{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}

    #2\clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR{index-cantuum/antiphonae}{alleluia.#1}{\@Antiphon@L}{\@Antiphon@R}
    \end{paracol}

    #2
  }
}

\NewDocumentCommand{\MakeChantPsalm}{s m m}{
  \def\@Link@Ref@L{index-cantuum/#2/#3/psalmus-v1}
  \def\@Link@Ref@R{index-cantuum/#2/#3/psalmus-v1-pt}
  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \GregorioImportL*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }
    \GregorioImportR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}

    \clearpage
  }{
    \begin{paracol}{2}
      \GregorioImportLR*{index-cantuum/#2}{#3}{psalmus-v1}{psalmus-v1-pt}
    \end{paracol}
  }
}

\newcommand{\DoGregorioImportL}{}
\newcommand{\DoGregorioImportR}{}
\newcommand{\DoGregorioImportLR}{}
\newtoggle{biginitial}
\NewDocumentCommand{\MakeChantLongPsalm}{s m m m}{
  \IfBooleanTF{#1}{\togglefalse{biginitial}}{\toggletrue{biginitial}}
  \renewcommand{\DoGregorioImportL}[2]{\iftoggle{biginitial}{\GregorioImportL{index-cantuum/#2}{#3}{##1}{##2}\togglefalse{biginitial}}{\GregorioImportL*{index-cantuum/#2}{#3}{##1}{##2}}}
  \renewcommand{\DoGregorioImportR}[2]{\iftoggle{biginitial}{\GregorioImportR{index-cantuum/#2}{#3}{##1}{##2}\togglefalse{biginitial}}{\GregorioImportR*{index-cantuum/#2}{#3}{##1}{##2}}}
  \renewcommand{\DoGregorioImportLR}[2]{\iftoggle{biginitial}{\GregorioImportLR{index-cantuum/#2}{#3}{##1}{##2}\togglefalse{biginitial}}{\GregorioImportLR*{index-cantuum/#2}{#3}{##1}{##2}}}
  \def\@Link@Ref@L{index-cantuum/#2/#3/psalmus-v1}
  \def\@Link@Ref@R{index-cantuum/#2/#3/psalmus-v1-pt}
  \input{index-cantuum/#2/#3/psalmus}

  \begin{annotation}
    \MakeVerseAnnotation{\@Verse@Annotation}
  \end{annotation}

  \iftoggle{compact}{
    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@R}{Ir para a adaptação para o vernáculo}
      \end{small}
      \vspace{-10pt}
    }{}
    \Map{\DoGregorioImportL}{#4}

    \clearpage

    \nottoggle{disablehyperlinks}{
      \begin{small}
        \noindent\hyperlink{\@Link@Ref@L}{Ir para o original em latim}
      \end{small}
      \vspace{-10pt}
    }{}
    \Map{\DoGregorioImportR}{#4}

    \clearpage
  }{
    \begin{paracol}{2}
      \Map{\DoGregorioImportLR}{#4}
    \end{paracol}
  }
}

\makeatother